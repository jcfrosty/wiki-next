



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Documentation for Sabayon Linux">
      
      
        <link rel="canonical" href="https://sabayon.github.io/wiki-next/articles/graphics_drivers/">
      
      
        <meta name="author" content="Sabayon">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.0.1">
    
    
      
        <title>TEAM RED - AMD - Sabayon Wiki</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.982221ab.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.1f0bcf2b.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../extra.css">
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#team-red-amd" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://sabayon.github.io/wiki-next/" title="Sabayon Wiki" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Sabayon Wiki
            </span>
            <span class="md-header-nav__topic">
              TEAM RED - AMD
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/Sabayon/wiki-next/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Sabayon/wiki-next
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://sabayon.github.io/wiki-next/" title="Sabayon Wiki" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Sabayon Wiki
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/Sabayon/wiki-next/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Sabayon/wiki-next
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Contributing
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Contributing
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../documentation/" title="Wiki" class="md-nav__link">
      Wiki
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../irc/" title="IRC|Testers" class="md-nav__link">
      IRC|Testers
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../entropy/" title="Entropy Package Manager" class="md-nav__link">
      Entropy Package Manager
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../howto/" title="How To Index" class="md-nav__link">
      How To Index
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#experimental-amdgpu" title="EXPERIMENTAL AMDGPU" class="md-nav__link">
    EXPERIMENTAL AMDGPU
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/Sabayon/wiki-next/edit/master/docs/articles/graphics_drivers.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="team-red-amd">TEAM RED - AMD</h1>
<pre class="clear">
######### SED #########
In these instructions you'll notice the sed command. This may make some people leary as not 
everyone understands this command. "sed" stands for "stream editor". It can edit the edit file 
for you by substituting lines, words, strings, etc. In this case we are using it to remove a 
line in blacklist.conf and nomodeset command in grub config files.

If you don't feel fully comfortable about this command. 
Back up your file or use nano (vi etc.) to edit the file!
</pre>

<h2 id="experimental-amdgpu">EXPERIMENTAL AMDGPU</h2>
<pre class="clear">
######### Not all AMD Display Code is not mainline! #########
This contains incomplete code that has yet not been adopted into the mainline kernel. 
Results may vary and this may not be the same as the finalized versions of code.
</pre>

<p>Beware, this is experimental and you're on your own. This is not a supported setup. It only allows you early access to AMDGPU upgrades.
You'll also want to be aware that you should still keep your current kernel in case anything goes wrong. That will allow you to continue booting into your system from the advanced options in GRUB by selecting the older kernel. </p>
<p>Lets get started with prep work!
<pre class="clear">
localhost root # equo repo enable sabayon-limbo
localhost root # equo update; equo upgrade
localhost root # equo install v86d bison make cmake automake gcc genkernel-next dracut sabayon-dracut git 
</pre></p>
<p>Now lets download a kernel with display code.
<pre class="clear">
localhost root # git clone -b amd-staging-drm-next --depth=1 git://people.freedesktop.org/~agd5f/linux  <br />
localhost root # mv linux /usr/src/linux-5.0.0-rc1+
localhost root # cd /usr/src
localhost root # rm -rf linux
localhost root # ln -s linux-5.0.0-rc1+/ linux
localhost root # cd linux
</pre></p>
<p>Now we finish configuring and building the kernel. Now's you chance to make any other config changes you want. If you use lvm or luks add the --lvm or --luks flag to the genkernel command.
You can also double check Device Drivers -&gt; Graphics Support -&gt; Display Engine Configuration -&gt; AMD DC is enabled as well as Raven family if you plan on owning an APU based on Raven.
<pre class="clear">
localhost root # zcat /proc/config.gz &gt; /usr/src/config
localhost root # genkernel --kernel-config=/usr/src/config --menuconfig --splash=sabayon kernel
localhost root # dracut -H -q -f -o systemd -o systemd-initrd -o systemd-networkd -o dracut-systemd --kver=5.0.0-rc1+ /boot/initramfs-genkernel-x86_64-5.0.0-rc1+
localhost root # grub2-mkconfig -o /boot/grub/grub.cfg 
</pre></p>
<p>You can watch the git repo for updates/fixes/changes etc at https://cgit.freedesktop.org/~agd5f/linux/log/?h=amd-staging-drm-next to decide if you want to update the kernel again. If you do this, none of the sed commands are necessary for the config as /proc/config.gz will already have the updated config changes.</p>
<h1 id="team-green-nvidia"><span style="color:green">TEAM GREEN - NVIDIA</span></h1>
<h2 id="booting-liveinstaller-disc-with-vesa-graphics-on-older-gpus">Booting live/installer disc with vesa graphics on older GPUs</h2>
<p>Can't seem to get the GUI on the installer disc and seem stuck at a black screen or terminal? We've got you covered. When selecting an option from the boot screen edit the boot line and include the following at the end of the line. 
<pre class="clear">
modprobe.blacklist=nvidia xdriver=vesa
</pre>
This should get you into the live session to perform an install. Afterwards, you'll need to either switch to Nouveau or a proprietary driver version that supports your card.</p>
<h2 id="proprietary">Proprietary</h2>
<p>Sabayon should already come with the latest nvidia-drivers, but if for some reason you don't have correct proprietary Nvidia drivers installed there are simple steps to follow.</p>
<h3 id="prepare-if-returning-from-nouveau">Prepare if returning from nouveau</h3>
<p>Because we use the proprietary drivers by default, the opensource driver is usually already blacklisted; but if you switched to the opensource driver and are returning to the proprietary offerings, you must first blacklist the opensource driver.
<pre class="clear">
localhost root # sed -i s/'#blacklist nouveau'/'blacklist nouveau'/ /etc/modprobe.d/blacklist.conf
</pre></p>
<h3 id="available-driver-version">Available driver version</h3>
<p>To get a list of all drivers for all kernels that are available:
<pre class="clear">
localhost root # equo search -qv nvidia-drivers
</pre>
List of all drivers versions available for currently running kernel:
<pre class="clear">
localhost root # equo search -qv nvidia-drivers#$(uname -r)
</pre></p>
<h3 id="newest-drivers-for-currently-running-kernel">Newest drivers for currently running kernel</h3>
<p><pre class="clear">
localhost root # equo install --ask nvidia-driver#$(uname -r) nvidia-userspace
</pre>
Will install newest driver available for currently running kernel.</p>
<h3 id="older-drivers-for-currently-running-kernel">Older drivers for currently running kernel</h3>
<pre class="clear">
######### Not supported or Guaranteed #########
It has been noticed that depending on the old GPU or GPU drivers version, they may or may not work. 
This seems pretty hit and miss.Mobile GPUs and non-discrete GPUs (integrated in the motherboard) 
appear to be affected by this. If you're using an GPU older than Fermi or an integrated GPU, 
we recommend using the open source nouveau driver.
</pre>

<p>List Nvidia drivers for your current kernel (insturctions above), and install it along with corresponding '''nvidia-userspace''', e.g.:
<pre class="clear">
localhost root # equo install --ask nvidia-drivers-340.104#$(uname -r) nvidia-drivers-340.104
</pre>
now lets switch from opensource opengl libraries to proprietary nvidia opengl libraries
<pre class="clear">
localhost root # eselect opengl set nvidia
</pre></p>
<h2 id="open-source-switching-to-nouveau-drivers">Open Source - Switching to Nouveau drivers</h2>
<pre class="clear">

<h6 id="warning-fermi-and-older-cards-have-no-reclocking-support">### <strong><em>WARNING! FERMI AND OLDER CARDS HAVE NO RECLOCKING SUPPORT</em></strong></h6>
<p>Fermi cards (Geforce 400 and 500 series cards) and older do not have reclocking support.
What does this mean exactly? Basically your GPU boots up in a power saving state. The pstate is on "LOW"
This means the cards will boot up with extremely low clock speeds. Without reclocking support you cannot
change the power state to force the GPU into performance mode, making it able to play games. This driver
is not recommended for GPUs older than Geforce 600 Series unless you're using it for basic productivity tasks.
</pre>
If Sabayon is installed you reboot and you find you're stuck at a login terminal or just wan to switch to open source drivers, this is a simple fix. 
Just login with your user you created. Then we'll remove the proprietary drivers and the blacklist for nouveau using the following:</p>
<h3 id="unblock-nouveau-driver">Unblock nouveau driver</h3>
<p>Because we use the proprietary drivers by default, the opensource driver is blacklisted. You must first unblock the driver from being loaded.
<pre class="clear">
localhost root # sed -i s/'blacklist nouveau'/'#blacklist nouveau'/ /etc/modprobe.d/blacklist.conf
</pre>
You still must block or remove the proprietary driver. Now that both drivers have the ability to load, it will most likely lock up the machine
on boot or cause instability. Both drivers cannot be loaded at the same time.</p>
<h3 id="removal-of-proprietary-driver">Removal of proprietary driver</h3>
<p>You can blacklist the nvidia drivers OR remove them entirely. Removal is the simplest method.
<pre class="clear">
localhost root # equo update; equo remove nvidia-drivers nvidia-userspace
</pre>
Now lets make sure we're using the correct opengl libraries
<pre class="clear">
localhost root # eselect opengl set xorg-x11
</pre>
Not done yet. We need to rebuild initramfs so that it doesn't include nvidia-drivers upon boot.
<pre class="clear">
localhost root # sabayon-dracut --rebuild-all
</pre>
Now reboot and you'll be using nouveau. If you ever feel like returning to proprietary drivers, you'll need to blacklist nouveau again.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.b806dc00.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>